{%extends "base.html" %}
{% block header %}
{% if current_user.is_admin %}
  <ul class="navbar-nav float-right">
  <li class="nav-item float-right">
  <a class="nav-link" href="{{ url_for('admin.user_edit',method='edit')}}"><i class="fas fa-cogs"></i> Admin</a>
  </li>
</ul>
{% endif %}
{% endblock %}

{% block content %}
{{ flashes() }}
<style>
#progress-outer {
	height: 0px;
	transition: height 0.4s linear;
}
#progress-outer.expanded {
	height: 40px;
}
</style>

 <form id="form" action="/submit_task" method="post"  class="needs-validation" novalidate>
  <div class="form-group row">
    <label for="files" class="col-sm-2 col-form-label" >File</label>
        <div class="col-sm-10">
    		<input type="file" class="form-control " id="files" name="file" accept=".dat" required/>
		    <div class="invalid-feedback">
			    A file is required.
		    </div>
    	</div>
  </div>
  <div class="form-group row" id="extra_files_entry">
    <label for="files" class="col-sm-2 col-form-label" >Additional files</label>
        <div class="col-sm-10">
    		<input type="file" class="form-control " id="extra_files" name="extra_files" multiple disabled/>
    	</div>
  </div>

<div class="card my-2">
  <div class="card-header">
    Scan Information
  </div>
  <div class="card-body" >
  <div class="form-group row">
    <label for="patientName" class="col-sm-2 col-form-label">Patient Name</label>
    <div class="col-sm-10">
    <input type="text" name="patient_name" class="form-control" id="patientName" placeholder="Patient name" required>
	    <div class="invalid-feedback">
		    A patient name is required.
	    </div>
	</div>
  </div>
  <div class="form-group row">
    <label for="accession" class="col-sm-2 col-form-label">Accession number</label>
    <div class="col-sm-10">
    <input type="text" name="accession" class="form-control" id="accession" placeholder="Accession">
	</div>
  </div>
  <div class="form-group row">
    <label for="taskId" class="col-sm-2 col-form-label">Task ID</label>
    <div class="col-sm-10">
    <input type="text" name="taskid" class="form-control" id="taskId" placeholder="Task ID" required>
	</div>
  </div>
  <input name='protocol'  type="hidden" class="form-control" id="protocol" value="Unknown">

</div>
</div>

<div class="card my-4">
  <div class="card-header">
	Reconstruction Settings
  </div>
  <div class="card-body">
    <h5 class="card-title"></h5>
      <div class="form-group row">
	    <label for="mode" class="col-sm-2 col-form-label">Server</label>
	    <div class="col-sm-10">
	    <select  name="server"  class="form-control" id="server" required>
		    {% for server in servers %}
	    	<option value="{{server.name}}">{{ server.name }}</option>
	    	{% endfor %}
	    </select>
   		</div>
   	  </div>
      <div class="form-group row">
	    <label for="mode" class="col-sm-2 col-form-label">Mode</label>
	    <div class="col-sm-10" id="modes">
	    {% for server in servers %}
	    <select name="mode_{{server.name}}"  class="form-control {% if not loop.first %} d-none {%endif %}" id="mode_{{server.name}}" required>
	    	{% for mode in server.modes %}
	    	<option value="{{mode.name}}">{{ mode.desc }}</option>
	    	{% endfor %}
	    </select>
	    {% endfor %}
  		</div>
   	  </div>


    {% for server in servers %}
	{% for mode in server.modes %}
		{% if mode.param_label %}
		  <div class="form-group row mode_param_entry d-none" id="mode_{{server.name}}_{{mode.name}}_param">
		    <label for="notification" class="col-sm-2 col-form-label"><strong>{{mode.param_label}}</strong></label>
		    <div class="col-sm-10">
		    <input name='param'  type="number" min="{{mode.param_min}}" max="{{mode.param_max}}" class="form-control" placeholder="">
    	    <div class="invalid-feedback">
			    Must be an integer between {{mode.param_min}} and {{mode.param_max}} inclusive
    		</div>
	       </div>
		  </div>
    {% endif %}

    {% endfor %}
    {% endfor %}


	  <div class="form-group row">
	    <label for="notification" class="col-sm-2 col-form-label">Notification</label>
	    <div class="col-sm-10">
	    <input name='notification'  type="text" class="form-control" id="notification" placeholder="">
		</div>
	  </div>
      <div class="form-group row">
	    <label for="processing" class="col-sm-2 col-form-label">Processing</label>
	    <div class="col-sm-10">
	    <select name='processing'  class="form-control" id="processing">
	    	<option>Default</option>
	    	<option>Night</option>
	    	<option>Priority</option>
	    </select>
   		</div>
   	  </div>
	</div>
</div>
<div class="form-group row">
    <div class="col-12">
		<button class="btn btn-primary float-right" type="submit" id="submit_btn" disabled>Send Task</button>
    	<button class="btn btn-danger float-right mx-2 d-none" type="button" id="cancel_btn">Cancel</button>
    </div>
</div>
</form>
</div>
<div class="progress fixed-bottom m-2" id="progress-outer" >
  <div id="progress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"></div>
</div>
{% endblock %}

{% block footer %}
<script src="files/submit.js"></script>
<script src="files/resumable.js"></script>
<script type="text/javascript">
$('.custom-file input').change(function (e) {
	var files = [];
	for (var i = 0; i < $(this)[0].files.length; i++) {
		files.push($(this)[0].files[i].name);
	}
	$(this).next('.custom-file-label').html(files.join(', '));
});
</script>
{% endblock %}
